
export type LanguageLevel = "A0" | "A1" | "A2" | "B1" | "B2" | "C1" | "C2";

export const ALL_LEVELS: LanguageLevel[] = ["A0", "A1", "A2", "B1", "B2", "C1", "C2"];

export type ModuleType = "vocabulary" | "grammar" | "listening" | "reading" | "writing" | "wordTest";

export const ALL_MODULE_TYPES: ModuleType[] = ["vocabulary", "grammar", "listening", "reading", "writing", "wordTest"];
export const MODULE_NAMES_RU: Record<ModuleType, string> = {
  vocabulary: "Лексика",
  grammar: "Грамматика",
  listening: "Аудирование",
  reading: "Чтение",
  writing: "Письмо",
  wordTest: "Тест по словам"
};

export interface VocabularyWord {
  id: string;
  german: string;
  russian: string;
  topic: string; // topicId
  level: LanguageLevel;
  consecutiveCorrectAnswers: number;
  lastTestedDate?: string; // ISO date string
  errorCount: number;
  exampleSentence?: string; // Optional, can be generated by AI
}

export interface ModuleProgress {
  score: number | null; // Percentage
  completed: boolean;
  lastAttemptDate?: string; // ISO date string
  attempts: number;
}

export interface TopicProgress {
  id: string; // e.g., "greetings"
  name: string; // e.g., "Приветствия"
  modules: Partial<Record<ModuleType, ModuleProgress>>;
  completed: boolean;
  custom?: boolean; // True if user-defined topic
}

export interface LevelProgress {
  topics: Record<string, TopicProgress>; // Keyed by topic ID
  completed: boolean;
}

export interface UserProfile {
  name?: string;
  preferredTopics?: string[];
}

export interface UserSettings {
  notificationsEnabled: boolean;
  lastActivityTimestamp?: number; // Unix timestamp
  darkMode?: boolean;
}

export interface GrammarWeaknessContext {
  level: LanguageLevel;
  topicId: string;
  topicName: string;
  moduleId?: ModuleType; 
}

export interface GrammarWeaknessDetail {
  tag: string; 
  count: number;
  lastEncounteredDate: string; 
  exampleContexts: GrammarWeaknessContext[]; 
}

export interface UserData {
  currentLevel: LanguageLevel;
  currentTopicId?: string; 
  profile: UserProfile;
  progress: Partial<Record<LanguageLevel, LevelProgress>>;
  vocabularyBank: VocabularyWord[];
  settings: UserSettings;
  customTopics: TopicProgress[]; 
  grammarWeaknesses?: Record<string, GrammarWeaknessDetail>; 
}

// --- AI Generated Content Types (matches flows) ---

export interface AILessonVocabularyItem {
  german: string;
  russian: string;
  exampleSentence?: string;
}

// --- Grammar Exercise Types ---
export interface AIFillInTheBlanksQuestion {
  promptText: string;
  correctAnswers: string[];
  explanation?: string;
}

export interface AIFillInTheBlanksExercise {
  type: "fillInTheBlanks";
  instructions: string;
  questions: AIFillInTheBlanksQuestion[];
}

export interface AIMultipleChoiceQuestion {
  questionText: string;
  options: string[];
  correctAnswer: string;
  explanation?: string;
}

export interface AIMultipleChoiceExercise {
  type: "multipleChoice";
  instructions: string;
  questions: AIMultipleChoiceQuestion[];
}

export interface AISentenceConstructionTask {
  words: string[];
  possibleCorrectSentences: string[];
  explanation?: string;
}

export interface AISentenceConstructionExercise {
  type: "sentenceConstruction";
  instructions: string;
  tasks: AISentenceConstructionTask[];
}

// This type is now only for individual exercise structures, not for the main lesson content.
export type AIGrammarExercise = 
  | AIFillInTheBlanksExercise 
  | AIMultipleChoiceExercise 
  | AISentenceConstructionExercise;

// --- Standard Listening ---
export interface AILessonListeningExercise {
  script: string;
  questions: string[]; // Open-ended questions
}

// --- Interactive Vocabulary Exercise Types ---
export interface AIMatchingPair {
  german: string;
  russian: string;
}
export interface AIMatchingExercise {
  type: "matching";
  instructions: string;
  pairs: AIMatchingPair[];
  germanDistractors?: string[];
  russianDistractors?: string[];
}

export interface AIAudioQuizItem {
  germanPhraseToSpeak: string;
  options: string[]; // Russian translations
  correctAnswer: string; // One of the options
  explanation?: string;
}
export interface AIAudioQuizExercise {
  type: "audioQuiz";
  instructions: string;
  items: AIAudioQuizItem[];
}

// --- Common Interactive Exercise Types for Listening/Reading ---
export interface AIComprehensionMQ_Question { 
  questionText: string;
  options: string[];
  correctAnswer: string;
  explanation?: string;
}
export interface AIComprehensionMultipleChoiceExercise {
  type: "comprehensionMultipleChoice";
  instructions: string;
  questions: AIComprehensionMQ_Question[];
}

export interface AITrueFalseStatement {
  statement: string;
  isTrue: boolean;
  explanation?: string;
}
export interface AITrueFalseExercise {
  type: "trueFalse";
  instructions: string;
  statements: AITrueFalseStatement[];
}

export interface AISequencingExercise {
  type: "sequencing";
  instructions: string;
  shuffledItems: string[];
  correctOrder: string[];
}

// --- Main Lesson Content Structure ---
export interface AILessonContent {
  lessonTitle: string;
  vocabulary: AILessonVocabularyItem[]; // No .min constraint in Zod
  grammarExplanation: string;
  
  // Grammar exercises split into individual optional fields
  grammarFillInTheBlanks?: AIFillInTheBlanksExercise;
  grammarMultipleChoice?: AIMultipleChoiceExercise;
  grammarSentenceConstruction?: AISentenceConstructionExercise;
  
  listeningExercise: AILessonListeningExercise; // questions array has no .min constraint in Zod
  readingPassage: string;
  readingQuestions: string[]; // No .min constraint in Zod
  writingPrompt: string; 

  // Interactive Vocabulary (Split)
  interactiveMatchingExercise?: AIMatchingExercise;
  interactiveAudioQuizExercise?: AIAudioQuizExercise;

  // Interactive Listening (Split)
  interactiveListeningMCQ?: AIComprehensionMultipleChoiceExercise;
  interactiveListeningTrueFalse?: AITrueFalseExercise;
  interactiveListeningSequencing?: AISequencingExercise;
  
  // Interactive Reading (Split)
  interactiveReadingMCQ?: AIComprehensionMultipleChoiceExercise;
  interactiveReadingTrueFalse?: AITrueFalseExercise;
  interactiveReadingSequencing?: AISequencingExercise;
}

export interface AIEvaluationResult {
  evaluation: string;
  isCorrect: boolean;
  suggestedCorrection?: string;
  grammarErrorTags?: string[]; 
}

export interface AIRecommendedLesson {
  topic: string;
  modules: string[]; 
  reasoning: string;
}

export interface DefaultTopicDefinition {
  id: string;
  name: string;
  fallbackVocabulary?: AILessonVocabularyItem[];
}

// Default Topics
export const DEFAULT_TOPICS: Record<LanguageLevel, DefaultTopicDefinition[]> = {
  A0: [
    { 
      id: "a0_greetings_farewells", name: "Основные приветствия и прощания",
      fallbackVocabulary: [
        { german: "Hallo", russian: "Привет", exampleSentence: "Hallo, wie geht's?" },
        { german: "Guten Morgen", russian: "Доброе утро", exampleSentence: "Guten Morgen, Herr Schmidt." },
        { german: "Guten Tag", russian: "Добрый день", exampleSentence: "Guten Tag, Frau Meier." },
        { german: "Guten Abend", russian: "Добрый вечер", exampleSentence: "Guten Abend zusammen." },
        { german: "Tschüss", russian: "Пока", exampleSentence: "Tschüss, bis bald!" },
        { german: "Auf Wiedersehen", russian: "До свидания", exampleSentence: "Auf Wiedersehen, meine Damen und Herren." },
        { german: "Bitte", russian: "Пожалуйста / Прошу", exampleSentence: "Kann ich bitte Wasser haben?" },
        { german: "Danke", russian: "Спасибо", exampleSentence: "Danke für Ihre Hilfe." },
        { german: "Ja", russian: "Да", exampleSentence: "Ja, das stimmt." },
        { german: "Nein", russian: "Нет", exampleSentence: "Nein, das ist nicht richtig." },
      ]
    },
    { 
      id: "a0_numbers_dates", name: "Числа и даты",
      fallbackVocabulary: [
        { german: "eins", russian: "один", exampleSentence: "Ich habe eins." },
        { german: "zwei", russian: "два", exampleSentence: "Zwei Äpfel, bitte." },
        { german: "drei", russian: "три", exampleSentence: "Drei Kinder spielen." },
        { german: "vier", russian: "четыре" },
        { german: "fünf", russian: "пять" },
        { german: "Montag", russian: "понедельник", exampleSentence: "Heute ist Montag." },
        { german: "Dienstag", russian: "вторник" },
        { german: "Januar", russian: "январь", exampleSentence: "Im Januar ist es kalt." },
        { german: "Februar", russian: "февраль" },
      ]
    },
    { 
      id: "a0_family_friends", name: "Семья и друзья",
      fallbackVocabulary: [
        { german: "die Familie", russian: "семья", exampleSentence: "Das ist meine Familie." },
        { german: "die Mutter", russian: "мама", exampleSentence: "Meine Mutter kocht." },
        { german: "der Vater", russian: "папа", exampleSentence: "Mein Vater liest." },
        { german: "der Bruder", russian: "брат", exampleSentence: "Ich habe einen Bruder." },
        { german: "die Schwester", russian: "сестра", exampleSentence: "Meine Schwester singt." },
        { german: "der Freund", russian: "друг (м.р.)", exampleSentence: "Das ist mein Freund." },
        { german: "die Freundin", russian: "подруга", exampleSentence: "Sie ist meine Freundin." },
      ]
    },
    { 
      id: "a0_colors", name: "Цвета",
      fallbackVocabulary: [
        { german: "rot", russian: "красный", exampleSentence: "Der Apfel ist rot." },
        { german: "blau", russian: "синий", exampleSentence: "Der Himmel ist blau." },
        { german: "grün", russian: "зеленый", exampleSentence: "Das Gras ist grün." },
        { german: "gelb", russian: "желтый", exampleSentence: "Die Sonne ist gelb." },
        { german: "schwarz", russian: "черный", exampleSentence: "Die Katze ist schwarz." },
        { german: "weiß", russian: "белый", exampleSentence: "Der Schnee ist weiß." },
        { german: "die Farbe", russian: "цвет", exampleSentence: "Was ist deine Lieblingsfarbe?" },
      ]
    },
    { 
      id: "a0_body_parts", name: "Части тела",
      fallbackVocabulary: [
        { german: "der Kopf", russian: "голова", exampleSentence: "Das ist mein Kopf." },
        { german: "der Arm", russian: "рука (от плеча до кисти)", exampleSentence: "Mein Arm tut weh." },
        { german: "das Bein", russian: "нога (от бедра до стопы)", exampleSentence: "Ich habe zwei Beine." },
        { german: "die Hand", russian: "рука (кисть)", exampleSentence: "Gib mir deine Hand." },
        { german: "der Fuß", russian: "стопа", exampleSentence: "Mein Fuß ist groß." },
        { german: "das Auge", russian: "глаз", exampleSentence: "Blaue Augen." },
        { german: "die Nase", russian: "нос", exampleSentence: "Eine kleine Nase." },
      ]
    },
    { 
      id: "a0_home_objects", name: "Дом и предметы в доме",
      fallbackVocabulary: [
        { german: "das Haus", russian: "дом", exampleSentence: "Wir wohnen in einem Haus." },
        { german: "der Tisch", russian: "стол", exampleSentence: "Das Buch liegt auf dem Tisch." },
        { german: "der Stuhl", russian: "стул", exampleSentence: "Setz dich auf den Stuhl." },
        { german: "das Bett", russian: "кровать", exampleSentence: "Ich gehe ins Bett." },
        { german: "die Tür", russian: "дверь", exampleSentence: "Die Tür ist zu." },
        { german: "das Fenster", russian: "окно", exampleSentence: "Mach das Fenster auf." },
        { german: "die Lampe", russian: "лампа", exampleSentence: "Die Lampe ist an." },
      ]
    },
    { 
      id: "a0_food_drinks", name: "Продукты питания и напитки",
      fallbackVocabulary: [
        { german: "das Brot", russian: "хлеб", exampleSentence: "Ich esse Brot mit Käse." },
        { german: "die Milch", russian: "молоко", exampleSentence: "Ich trinke Milch." },
        { german: "das Wasser", russian: "вода", exampleSentence: "Ein Glas Wasser, bitte." },
        { german: "der Apfel", russian: "яблоко", exampleSentence: "Der Apfel ist süß." },
        { german: "die Banane", russian: "банан", exampleSentence: "Affen mögen Bananen." },
        { german: "der Käse", russian: "сыр", exampleSentence: "Käse schmeckt gut." },
        { german: "das Ei", russian: "яйцо", exampleSentence: "Ich koche ein Ei." },
      ]
    },
    { 
      id: "a0_clothing", name: "Одежда",
      fallbackVocabulary: [
        { german: "das Hemd", russian: "рубашка", exampleSentence: "Er trägt ein blaues Hemd." },
        { german: "die Hose", russian: "брюки, штаны", exampleSentence: "Meine Hose ist neu." },
        { german: "der Schuh", russian: "ботинок, туфля", exampleSentence: "Ich brauche neue Schuhe." },
        { german: "die Jacke", russian: "куртка", exampleSentence: "Zieh deine Jacke an." },
        { german: "der Rock", russian: "юбка", exampleSentence: "Sie trägt einen roten Rock." },
        { german: "das T-Shirt", russian: "футболка", exampleSentence: "Ein weißes T-Shirt." },
        { german: "der Hut", russian: "шляпа", exampleSentence: "Ein großer Hut." },
      ]
    },
    { 
      id: "a0_simple_motion_verbs", name: "Простые глаголы движения",
      fallbackVocabulary: [
        { german: "gehen", russian: "идти", exampleSentence: "Ich gehe nach Hause." },
        { german: "kommen", russian: "приходить", exampleSentence: "Wann kommst du?" },
        { german: "laufen", russian: "бежать", exampleSentence: "Die Kinder laufen schnell." },
        { german: "stehen", russian: "стоять", exampleSentence: "Er steht an der Tür." },
        { german: "sitzen", russian: "сидеть", exampleSentence: "Wir sitzen auf dem Sofa." },
        { german: "fahren", russian: "ехать", exampleSentence: "Ich fahre mit dem Auto." },
        { german: "fliegen", russian: "летать", exampleSentence: "Vögel können fliegen." },
      ]
    },
    { 
      id: "a0_simple_nouns_city_school", name: "Простые существительные (город, школа)",
      fallbackVocabulary: [
        { german: "die Stadt", russian: "город", exampleSentence: "Berlin ist eine große Stadt." },
        { german: "die Schule", russian: "школа", exampleSentence: "Die Kinder gehen in die Schule." },
        { german: "das Buch", russian: "книга", exampleSentence: "Ich lese ein Buch." },
        { german: "der Stift", russian: "ручка, карандаш", exampleSentence: "Hast du einen Stift?" },
        { german: "der Lehrer", russian: "учитель", exampleSentence: "Der Lehrer erklärt die Aufgabe." },
        { german: "die Lehrerin", russian: "учительница", exampleSentence: "Die Lehrerin ist nett." },
        { german: "das Auto", russian: "машина", exampleSentence: "Mein Auto ist rot." },
      ]
    }
  ],
  A1: [
    { id: "a1_work_professions", name: "Работа и профессии" },
    { id: "a1_travel_transport", name: "Путешествия и транспорт" },
    { id: "a1_time_schedule", name: "Время и расписание" },
    { id: "a1_hobbies_interests", name: "Хобби и увлечения" },
    { id: "a1_shops_shopping", name: "Магазины и покупки" },
    { id: "a1_emotions_states", name: "Простые эмоции и состояния" },
    { id: "a1_simple_adjectives", name: "Простые прилагательные" }
  ],
  A2: [
    { id: "a2_health_medical_care", name: "Здоровье и медицинская помощь" },
    { id: "a2_weather_nature", name: "Погода и природа" },
    { id: "a2_education_studies", name: "Образование и учеба" },
    { id: "a2_relationships_family", name: "Отношения и семья (углубл.)" },
    { id: "a2_city_surroundings", name: "Город и окрестности" },
    { id: "a2_simple_phrasal_verbs", name: "Простые фразовые глаголы" }
  ],
  B1: [
    { id: "b1_work_career", name: "Работа и карьера" },
    { id: "b1_travel_culture", name: "Путешествия и культура" },
    { id: "b1_politics_society", name: "Политика и общество" },
    { id: "b1_technology", name: "Технологии" },
    { id: "b1_ecology_environment", name: "Экология и окружающая среда" },
    { id: "b1_holidays_traditions", name: "Праздники и традиции" }
  ],
  B2: [
    { id: "b2_science_technology", name: "Наука и техника" },
    { id: "b2_art_culture", name: "Искусство и культура" },
    { id: "b2_education_science", name: "Образование и наука" },
    { id: "b2_politics_economics", name: "Политика и экономика" },
    { id: "b2_social_issues", name: "Социальные проблемы" }
  ],
  C1: [
    { id: "c1_abstract_topics", name: "Абстрактные темы" },
    { id: "c1_professional_vocabulary", name: "Профессиональная лексика" },
    { id: "c1_discussion_topics", name: "Дискуссионные темы" },
    { id: "c1_philosophy_psychology", name: "Философия и психология" }
  ],
  C2: [
    { id: "c2_expert_terminology", name: "Экспертная терминология" },
    { id: "c2_rare_stylized_expressions", name: "Редкие и высоко стилизованные выражения" },
    { id: "c2_cultural_historical_references", name: "Культурные и исторические ссылки" }
  ],
};

